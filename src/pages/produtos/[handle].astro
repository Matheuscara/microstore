---
import { Image } from "astro:assets";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getAllProducts, getProductByHandle } from "@/lib/shopify";

export async function getStaticPaths() {
    const products = await getAllProducts();

    return products.map((product) => ({
        params: { handle: product.handle },
        props: { product: product },
    }));
}

const { product } = Astro.props;
const data = await getProductByHandle(product.handle);
console.log(data);
---

<BaseLayout>
    <section class="container mx-auto py-12">
        <Image
            width={1024}
            height={1024}
            alt={product.title}
            src={product.images.edges[0].node.url}
            class="w-full max-w-lg mx-auto rounded shadow"
            transition:name={`product-image-${product.handle}`}
        />

        {
            product.variants && product.variants.edges.length > 0 && (
                <div class="mt-8">
                    <h2 class="text-xl font-bold mb-4">Opções</h2>
                    <div class="flex flex-wrap gap-4 justify-center md:justify-start">
                        {product.variants.edges.map((variant) => (
                            <button
                                class="px-4 py-2 border rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
                                disabled={!variant.node.availableForSale}
                            >
                                {variant.node.title}
                            </button>
                        ))}
                    </div>
                </div>
            )
        }

        <div class="mt-8 text-center">
            <h1 class="text-3xl font-bold">{product.title}</h1>
            <h1 class="text-3xl font-bold">{product.id}</h1>

            <p class="text-xl text-primary-600 mt-2">
                {product.priceRange.minVariantPrice.amount} BRL
            </p>
        </div>
    </section>
</BaseLayout>
