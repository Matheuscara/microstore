---
import "@splidejs/splide/css";

const services = [
    {
        title: "Design UI/UX",
        imgUrl: "https://placehold.co/1200x800/3B82F6/FFFFFF?text=Design+UI%2FUX",
    },
    {
        title: "Programação Web (Astro/React)",
        imgUrl: "https://placehold.co/1200x800/10B981/FFFFFF?text=Programação+Web",
    },
    {
        title: "Desenvolvimento Mobile",
        imgUrl: "https://placehold.co/1200x800/8B5CF6/FFFFFF?text=Dev+Mobile",
    },
    {
        title: "Identidade Visual & Branding",
        imgUrl: "https://placehold.co/1200x800/F97316/FFFFFF?text=Branding",
    },
    {
        title: "Sistemas e APIs",
        imgUrl: "https://placehold.co/1200x800/1F2937/FFFFFF?text=Sistemas+e+APIs",
    },
];
---

<div class="splide splide-padding-carousel w-full py-4" role="group" data-splide-carousel>
    <div class="splide__track">
        <ul class="splide__list">
            {
                services.map((service) => (
                    <li class="splide__slide">
                        <div class="p-2 transition-transform duration-300 ease-in-out hover:scale-[1.02]">
                            <div class="overflow-hidden rounded-sm bg-card">
                                <img
                                    width={1200}
                                    height={400}
                                    alt={service.title}
                                    src={service.imgUrl}
                                    class="w-full h-auto aspect-[2/1] object-cover"
                                    loading="lazy"
                                />
                            </div>
                        </div>
                    </li>
                ))
            }
        </ul>
    </div>
</div>

<script>
    import Splide from "@splidejs/splide";

    // 1. Criamos uma função para "montar" o carrossel
    function mountCarousel() {
        // Selecionamos TODOS os carrosséis desta página
        // (usando o 'data-attribute' que colocamos no HTML)
        const elements = document.querySelectorAll("[data-splide-carousel]");

        elements.forEach((element) => {
            // 2. IMPORTANTE: Verificamos se já existe um carrossel "montado"
            //    neste elemento. Se sim, destruímos ele antes de criar um novo.
            //    Isso evita bugs de "montar" várias vezes.
            // @ts-ignore (Ignora o erro de 'splide' não existir no tipo)
            if (element.splide) {
                // @ts-ignore
                element.splide.destroy();
            }

            // 3. Criamos e montamos o Splide
            const splide = new Splide(element as any, {
                type: "loop",
                perPage: 1,
                gap: "1.5rem",
                arrows: false,
                pagination: false,
                padding: "3rem",
                breakpoints: {
                    768: {
                        padding: "3rem",
                        gap: "1rem",
                    },
                    640: {
                        padding: "2rem",
                        gap: "0.5rem",
                    },
                },
            });

            // 4. Guardamos a "instância" no próprio elemento
            //    para podermos destruir da próxima vez (passo 2)
            // @ts-ignore
            element.splide = splide.mount();
        });
    }

    // 5. Esta é a correção!
    // Ouvimos pelo evento 'astro:page-load', que roda na
    // primeira carga E DEPOIS de cada transição de página.
    document.addEventListener("astro:page-load", mountCarousel);
</script>
